@model appointment_mvc.Models.userpanel
@{
	ViewBag.Title = "AdminPanel";
	Layout = "~/Views/Shared/_Layout.cshtml";
}


<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous" />
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>


<link href="~/Content/jobcard.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.18"></script>


<div class="container-fluid" style="margin-top:66px;">
	<div class="section-first candidate_info  mt-2 pt-1 p-3 ">
		<!-- row -->
		<div class="row text-center ">
			<div class="col">
				<Label ID="Label141" class="col-form-labe sub-head" style="margin-bottom:20px;">User Details</Label>
			</div>
		</div>
		<!-- row -->
		<!-- row -->
		<div class="row mb-1 section-box">
			<div class="col-lg-3 input-box-section">
				<div class="lbl">
					<label class="col-lg-2 lbl">User Name</label>
				</div>
				<input type="text" id="username" class="form-control" value="@Model.company_name">
			</div>

			<div class="col-lg-3 input-box-section">

				<div class="lbl">
					<label class="col-lg-2 lbl">Password</label>
				</div>
				<input type="text" id="password" class="form-control" value="@Model.company_name">
			</div>
		</div>

		<div class="row mb-1 section-box">
			<div class="col-lg-3 input-box-section">
				<div class="lbl">
					<label class="col-lg-2 lbl">Company Name</label>
				</div>
				<input type="text" id="company_name" class="form-control" value="@Model.company_name">
			</div>

			<div class="col-lg-3 input-box-section">
				<div class="lbl">
					<label class="col-lg-2 lbl">Service Tax</label>
				</div>
				<input type="text" id="service_tax" class="form-control" value="@Model.service_tax">
			</div>

			<div class="col-lg-3 input-box-section">
				<div class="lbl">
					<label class="col-lg-2 lbl">Gst</label>
				</div>
				<input type="text" id="gst_rate" class="form-control" value="@Model.gst_rate">

			</div>

			<div class="col-lg-3 input-box-section">
				<div class="lbl">
					<label class="col-lg-2 lbl">Discount</label>
				</div>
				<input type="text" id="discount" class="form-control" value="@Model.discount">

			</div>
		</div>

		<div class="row mb-1 section-box">
			<div class="row">
				<label class="sub-head col-lg-2">Notification To Cutomer</label>

			</div>
			<div class="col-lg-2  input-box-section">
				<div class="lbl">
					<label class="col-lg-2 lbl">Whatsapp </label>
				</div>
				<input type="checkbox" id="whatsapp" class="form-check-input">


			</div>


			<div class="col-lg-2  input-box-section">
				<div class="lbl">
					<label class="col-lg-2 lbl">Text Message</label>
				</div>
				<input type="checkbox" id="text_message" class="form-check-input">


			</div>

			<div class="col-lg-2 input-box-section">
				<div class="lbl">
					<label class="col-lg-2 lbl">Vehicle Gate Pass</label>
				</div>
				<input type="checkbox" id="gate_pass" class="form-check-input">

			</div>



		</div>

		<div class="row mb-1 mt-3">
			<div class="col">
				<button type="button" id="submitBtn" class="btn btn-success">Submit</button>
			</div>
		</div>

	</div>
</div>
<script>
	// Get a reference to the submit button
	var submitBtn = document.getElementById('submitBtn');

	// Add a click event listener to the submit button
	submitBtn.addEventListener('click', function () {
		// Get the input field values
		var username = document.getElementById('username').value;
		var password = document.getElementById('password').value;
		var companyName = document.getElementById('company_name').value;
		var serviceTax = document.getElementById('service_tax').value;
		var gstRate = document.getElementById('gst_rate').value;
		var discount = document.getElementById('discount').value;
		var whatsapp = document.getElementById('whatsapp').checked ? 1 : 0;
		var textMessage = document.getElementById('text_message').checked ? 1 : 0;
		var gatePass = document.getElementById('gate_pass').checked ? 1 : 0;

		// Create an object to hold the data
		var data = {
			username: username,
			password: password,
			company_name: companyName,
			service_tax: serviceTax,
			gst_rate: gstRate,
			discount: discount,
			whatsapp: whatsapp,
			text_message: textMessage,
			gate_pass: gatePass
		};

		// Send the data to the controller using AJAX
		var xhr = new XMLHttpRequest();
		xhr.open('POST', '/home/HandleSubmit', true);
		xhr.setRequestHeader('Content-Type', 'application/json');
		xhr.onreadystatechange = function () {
			if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
				// Handle the response from the controller if needed
				var response = JSON.parse(xhr.responseText);
				if (response.success) {
					// Show SweetAlert success notification
					Swal.fire({
						icon: 'success',
						title: 'Success!',
						text: 'Data submitted successfully.'
					});
				} else {
					// Show SweetAlert error notification
					Swal.fire({
						icon: 'error',
						title: 'Error!',
						text: 'Failed to submit data.'
					});
				}
			}
		};
		xhr.send(JSON.stringify(data));
	});
</script>


<script>
	$(document).ready(function () {
		$('#password').on('blur', function () {
			var username = $('#username').val();
			var password = $(this).val();


			$.ajax({
				url: '/home/usersetting',
				method: 'POST',
				data: { username: username, password: password },
				success: function (response) {
					// Iterate over the result list
					$.each(response, function (index, item) {
						// Set the checkbox and input values based on the result data
						$('#whatsapp').prop('checked', item.whatsapp === 1);
						$('#text_message').prop('checked', item.text === 1);
						$('#service_tax').val(item.service_tax);
						$('#gst_rate').val(item.gst);
						$('#discount').val(item.discount);
						$('#gate_pass').prop('checked', item.gatepass === 1);
					});
				},
				error: function (xhr, status, error) {
					console.log(error);
				}
			});
		});
	});
</script>

